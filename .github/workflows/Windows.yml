name: Windows
on:
  workflow_dispatch:
    inputs:
      debug_enabled:
        type: boolean
        description: 'Run the build with tmate debugging enabled (https://github.com/marketplace/actions/debugging-with-tmate)'
        required: false
        default: true
jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - uses: microsoft/setup-msbuild@v1.1
      
      - name: Download FBX SDK
        run: |
          pip install gdown
          gdown https://drive.google.com/uc?id=1nflAivn0Us8cDmo4BFgiI_YI83i0SDDL
          md fbx
          cd fbx
          Invoke-WebRequest "https://damassets.autodesk.net/content/dam/autodesk/www/files/fbx202037_fbxsdk_vs2022_win.exe" -OutFile "fbxsdk.exe"
          Start-Process -FilePath "fbxsdk.exe" /S -Wait
          Invoke-WebRequest "https://damassets.autodesk.net/content/dam/autodesk/www/files/fbx202037_fbxsdk_vs2022_pdbs.exe" -OutFile "fbxpdb.exe"
          Start-Process -FilePath "fbxpdb.exe" /S -Wait
          cd ..

      - name: Clone
        run: |
             unzip 2020.3.7.zip
             git clone https://github.com/aelurum/AssetStudio.git
             copy D:\a\Android-kernel-compile\Android-kernel-compile\2020.3.7\include\* D:\a\Android-kernel-compile\Android-kernel-compile\AssetStudio\AssetStudioFBXNative
             cd AssetStudio/AssetStudioFBXNative
             md build

      - name: Build .Net8
        run: |
            cd AssetStudio/AssetStudioFBXNative
            msbuild AssetStudioFBXNative.vcxproj /p:Configuration=Release /p:TargetFramework=net8.0-windows /p:RuntimeIdentifier=linux-arm64 
        
      - uses: actions/checkout@v4
      - name: Setup tmate session
        uses: mxschmitt/action-tmate@v3
